<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot Password</title>
    <link rel="stylesheet" href="/assets/css/style.css" />
    <link rel="stylesheet" href="/assets/css/responsive.css" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
  </head>
  <body class="forgot-body">
    <div class="forgot-container">
      <h2>Forgot Password</h2>
      <form>
        <div class="form-group">
          <label for="email">Enter your registered Email/Username</label>
          <input
            type="text"
            id="email"
            placeholder="Email or Username"
            required
          />
        </div>
        <button type="submit">Send Reset Link</button>
      </form>

      <div class="back-link">
        <a href="login-all.html"
          ><i class="fa-solid fa-arrow-left"></i> Back to Login</a
        >
      </div>
    </div>
    <script>
      // assets/js/forgot_password.js

      let generatedOTP = null;
      let otpExpiryTime = null;

      // Function to generate 4-digit OTP
      function generateOTP() {
        return Math.floor(1000 + Math.random() * 9000); // 1000 - 9999
      }

      // Handle form submit
      document.querySelector("form").addEventListener("submit", function (e) {
        e.preventDefault();

        const email = document.getElementById("email").value.trim();

        if (email === "") {
          alert("Please enter your registered Email/Username.");
          return;
        }

        // TODO: ðŸ”— Yahan backend check karega ke email DB me hai ya nahi
        // Abhi demo ke liye assume karte hain valid email hamesha true hai

        generatedOTP = generateOTP();
        otpExpiryTime = Date.now() + 15000; // 15 sec expiry

        alert(`OTP sent to your email (Demo: ${generatedOTP})`); // ðŸš¨ Backend me email bhejna hoga

        // Show OTP input
        showOTPInput();
      });

      // Show OTP field dynamically
      function showOTPInput() {
        const form = document.querySelector("form");

        form.innerHTML = `
    <div class="form-group">
      <label for="otp">Enter 4-digit OTP (Expires in 15 sec)</label>
      <input type="number" id="otp" placeholder="Enter OTP" required />
    </div>
    <button type="button" onclick="verifyOTP()">Verify OTP</button>
  `;
      }

      // Verify OTP
      function verifyOTP() {
        const enteredOTP = document.getElementById("otp").value;

        if (!enteredOTP) {
          alert("Please enter the OTP.");
          return;
        }

        if (Date.now() > otpExpiryTime) {
          alert("OTP expired. Please request again.");
          window.location.reload(); // refresh page
          return;
        }

        if (parseInt(enteredOTP) === generatedOTP) {
          alert(
            "OTP verified successfully! Redirecting to Reset Password page..."
          );
          window.location.href = "reset-password.html"; // redirect
        } else {
          alert("Invalid OTP. Please try again.");
        }
      }
    </script>
  </body>
</html>
