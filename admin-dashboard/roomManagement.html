<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/assets/css/responsive.css" />
    <link rel="stylesheet" href="/assets/css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <title>Room Management</title>
  </head>
  <body>
    <div class="container">
      <aside class="sideBar">
        <div class="logo">
          <span>Hostify</span>
        </div>
        <nav>
          <ul>
            <li class="active" data-tab="dashboard" data-page=" dashboard.html">
              <i class="fa-solid fa-house"></i><span id>Dashboard</span>
            </li>
            <li data-tab="notification" data-page="notification.html">
              <i class="fa-solid fa-bell"></i>
              <span>Notification Panel</span>
            </li>
            <li data-tab="students" data-page="studentManagement.html">
              <i class="fa-solid fa-users"></i>
              <span>Student Management</span>
            </li>
            <li data-tab="payment" data-page="paymentVerification.html">
              <i class="fa-solid fa-money-bill-1-wave"></i>
              <span>Payment Verification</span>
            </li>
            <li data-tab="room" data-page="roomManagement.html">
              <i class="fa-solid fa-person-booth"></i>
              <span>Room Management</span>
            </li>
            <li data-tab="staff" data-page="staffManagement.html">
              <i class="fa-solid fa-user-tie"></i>
              <span>Staff Management</span>
            </li>
            <li data-tab="attendance" data-page="attendancePenalty.html">
              <i class="fa-solid fa-pencil"></i>
              <span>Attendance & Penalty</span>
            </li>
            <li data-tab="comp-feed" data-page="complaintFeedback.html">
              <i class="fa-solid fa-circle-exclamation"></i>
              <span>Complaints & Feedback</span>
            </li>
            <li data-tab="meal-feed" data-page="mealFeed.html">
              <i class="fa-solid fa-bowl-food"></i>
              <span>Meal Menu & Feedback</span>
            </li>
            <li data-tab="stay" data-page="stayExtensionRequests.html">
              <i class="fa-solid fa-bed"></i>
              <span>Stay Extension Requests</span>
            </li>
            <li data-tab="settings" data-page="settings.html">
              <i class="fa-solid fa-cog"></i>
              <span>Settings</span>
            </li>
          </ul>
        </nav>
      </aside>

      <main class="mainContent">
        <header class="topHeader">
          <div class="searchbar">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" id="globalSearch" placeholder="Search here..." />
          </div>
          <div class="userProfile">
            <img src="/assets/images/user-profile.avif" alt="Admin" />
            <span>Admin</span>
            <i class="fa-solid fa-chevron-down" id="profileToggle"></i>
            <ul class="profileDropdown" id="profileMenu">
              <li>
                <a href="profile.html"><i class="fa-solid fa-user"></i>Profile</a>
              </li>
              <li id="logoutBtn">
                <a href="/student-public.html/login-all.html"><i class="fa-solid fa-right-from-bracket"></i> Logout</li></a>
            </ul>
          </div>
        </header>

        <!-- room management tab -->
        <div class="tab-content active" id="room">
          <div class="tab-header">
            <h2>Room Management</h2>
            <button class="btn btn-primary" id="add-room-btn">
              <i class="fa-solid fa-plus"></i> Add Room
            </button>
          </div>
          <div class="table-container">
            <table id="room-table">
              <thead>
                <tr>
                  <th>Room No.</th>
                  <th>Type</th>
                  <th>Capacity</th>
                  <th>Occupied</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- room data will be populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- add room modal -->
        <div class="modal" id="add-room-modal">
          <div class="modalHeader">
            <h3>Add New Room</h3>
            <button class="closeModal">&times;</button>
          </div>
          <div class="modalBody">
            <form id="add-room-form">
              <div class="form-group">
                <label for="room-number">Room Number</label>
                <input type="text" id="room-number" required />
              </div>
              <div class="form-group">
                <label for="floor-number">Floor Number</label>
                <input type="number" id="floor-number" min="1" required />
              </div>
              <div class="form-group">
                <label for="allocate-date">Allocation Date</label>
                <input type="date" id="allocate-date" required />
              </div>
              <div class="form-group">
                <label for="room-type">Room Type</label>
                <select id="room-type" required>
                  <option value="">Select Type</option>
                  <!-- room types will be added dynamically -->
                </select>
              </div>
              <div class="form-group">
                <label for="room-capacity">Capacity</label>
                <input type="number" id="room-capacity" min="1" required />
              </div>
              <div class="form-group">
                <label for="room-price">Price (per month)</label>
                <input type="number" id="room-price" min="0" required />
              </div>
              <div class="form-group">
                <label for="room-status">Status</label>
                <select id="room-status">
                  <option value="Available">Available</option>
                  <option value="Under Maintenance">Under Maintenance</option>
                </select>
              </div>
              <div class="form-action">
                <button type="button" class="btn btn-secondary closeModal">
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary">Add Room</button>
              </div>
            </form>
          </div>
        </div>

        <!-- edit Room Modal -->
        <div class="modal" id="edit-room-modal">
          <div class="modalHeader">
            <h3>Edit Room</h3>
            <button class="closeModal">&times;</button>
          </div>
          <div class="modalBody">
            <form id="edit-room-form">
              <div class="form-group">
                <input type="hidden" id="edit-room-id" />
                <label for="edit-room-number">Room Number</label>
                <input type="text" id="edit-room-number" required />
              </div>
              <div class="form-group">
                <label for="edit-floor-number">Floor Number</label>
                <input type="number" id="edit-floor-number" required />
              </div>
              <div class="form-group">
                <label for="edit-allocate-date">Allocation Date</label>
                <input type="date" id="edit-allocate-date" required />
              </div>
              <div class="form-group">
                <label for="edit-room-type">Room Type</label>
                <select id="edit-room-type" required>
                  <option value="">Select Type</option>
                  <!-- room types will be added dynamically -->
                </select>
              </div>
              <div class="form-group">
                <label for="edit-room-capacity">Capacity</label>
                <input type="number" id="edit-room-capacity" min="1" required />
              </div>
              <div class="form-group">
                <label for="edit-room-price">Price (per month)</label>
                <input type="number" id="edit-room-price" min="0" required />
              </div>
              <div class="form-group">
                <label for="edit-room-status">Status</label>
                <select id="edit-room-status">
                  <option value="Available">Available</option>
                  <option value="Under Maintenance">Under Maintenance</option>
                </select>
              </div>
              <div class="form-action">
                <button type="button" class="btn btn-secondary closeModal">
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary">Update Room</button>
              </div>
            </form>
          </div>
        </div>
        <div class="modalOverlay" id="modal-overlay"></div>
        <div class="modal" id="details-modal">
        <div class="modalHeader">
          <h3 id="details-title">Details</h3>
          <button class="closeModal">&times;</button>
        </div>
        <div class="modalBody" id="details-content">
          <!-- details content will be added dynamically -->
        </div>
        <div class="modalFooter">
          <button type="button" class="btn btn-secondary closeModal">
            Close
          </button>
        </div>
      </div>

      </main>
    </div>
    <script src="/assets/js/nav.js" defer></script>
    <script src="/assets/js/logout.js" defer></script>
    <script src="/assets/js/mobileView.js" defer></script>
    <script src="/assets/js/profile.js" defer></script>
    <script src="/assets/js/searchbar.js" defer></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const addRoomBtn = document.getElementById("add-room-btn");
        const addRoomModal = document.getElementById("add-room-modal");
        const editRoomModal = document.getElementById("edit-room-modal");
        const detailsModal = document.getElementById("details-modal");
        const overlay = document.getElementById("modal-overlay");

        const addRoomForm = document.getElementById("add-room-form");
        const editRoomForm = document.getElementById("edit-room-form");
        const roomTableBody = document.querySelector("#room-table tbody");

        const roomTypeSelect = document.getElementById("room-type");
        const editRoomTypeSelect = document.getElementById("edit-room-type");

        // add default room types
        const roomTypes = ["Single", "Dormitory"];
        roomTypes.forEach(type => {
          const opt1 = document.createElement("option");
          opt1.value = type;
          opt1.textContent = type;
          roomTypeSelect.appendChild(opt1);

          const opt2 = document.createElement("option");
          opt2.value = type;
          opt2.textContent = type;
          editRoomTypeSelect.appendChild(opt2);
        });

        // Load rooms
        function loadRooms() {
          roomTableBody.innerHTML = "";
          const rooms = JSON.parse(localStorage.getItem("rooms")) || [];

          rooms.forEach((room, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${room.roomNo}</td>
              <td>${room.roomType}</td>
              <td>${room.capacity}</td>
              <td>${room.occupied || 0}</td>
              <td>${room.status}</td>
              <td>
                <button class="btn btn-sm btn-info" onclick="viewRoom(${index})">View</button>
                <button class="btn btn-sm btn-warning" onclick="editRoom(${index})">Update</button>
                <button class="btn btn-sm btn-danger" onclick="deleteRoom(${index})">Delete</button>
              </td>
            `;
            roomTableBody.appendChild(row);
          });
        }
        loadRooms();

        // Add room
        addRoomForm.addEventListener("submit", function (e) {
          e.preventDefault();

          const roomNo = document.getElementById("room-number").value;
          const floor = document.getElementById("floor-number").value;
          const allocateDate = document.getElementById("allocate-date").value;
          const roomType = document.getElementById("room-type").value;
          const capacity = parseInt(document.getElementById("room-capacity").value);
          const price = document.getElementById("room-price").value;
          const status = document.getElementById("room-status").value;

          let rooms = JSON.parse(localStorage.getItem("rooms")) || [];

          // duplicate room number check
          if (rooms.some(r => r.roomNo === roomNo)) {
            alert("Room number already exists!");
            return;
          }

          rooms.push({
            roomNo,
            floor,
            allocateDate,
            roomType,
            capacity,
            price,
            status,
            occupied: 0
          });

          localStorage.setItem("rooms", JSON.stringify(rooms));
          addRoomModal.style.display = "none";
          overlay.style.display = "none";
          addRoomForm.reset();
          loadRooms();
        });

        // view room
        window.viewRoom = function (index) {
          const rooms = JSON.parse(localStorage.getItem("rooms")) || [];
          const room = rooms[index];

          document.getElementById("details-title").textContent = "Room Details";
          document.getElementById("details-content").innerHTML = `
            <p><b>Room No:</b> ${room.roomNo}</p>
            <p><b>Floor:</b> ${room.floor}</p>
            <p><b>Allocation Date:</b> ${room.allocateDate}</p>
            <p><b>Type:</b> ${room.roomType}</p>
            <p><b>Capacity:</b> ${room.capacity}</p>
            <p><b>Occupied:</b> ${room.occupied}</p>
            <p><b>Price:</b> ${room.price}</p>
            <p><b>Status:</b> ${room.status}</p>
          `;
          detailsModal.style.display = "block";
          overlay.style.display = "block";
        };

        // edit room
        window.editRoom = function (index) {
          const rooms = JSON.parse(localStorage.getItem("rooms")) || [];
          const room = rooms[index];

          document.getElementById("edit-room-id").value = index;
          document.getElementById("edit-room-number").value = room.roomNo;
          document.getElementById("edit-floor-number").value = room.floor;
          document.getElementById("edit-allocate-date").value = room.allocateDate;
          document.getElementById("edit-room-type").value = room.roomType;
          document.getElementById("edit-room-capacity").value = room.capacity;
          document.getElementById("edit-room-price").value = room.price;
          document.getElementById("edit-room-status").value = room.status;

          editRoomModal.style.display = "block";
          overlay.style.display = "block";
        };

        // save updated room
        editRoomForm.addEventListener("submit", function (e) {
          e.preventDefault();
          const index = document.getElementById("edit-room-id").value;

          let rooms = JSON.parse(localStorage.getItem("rooms")) || [];
          rooms[index] = {
            ...rooms[index],
            roomNo: document.getElementById("edit-room-number").value,
            floor: document.getElementById("edit-floor-number").value,
            allocateDate: document.getElementById("edit-allocate-date").value,
            roomType: document.getElementById("edit-room-type").value,
            capacity: parseInt(document.getElementById("edit-room-capacity").value),
            price: document.getElementById("edit-room-price").value,
            status: document.getElementById("edit-room-status").value
          };

          localStorage.setItem("rooms", JSON.stringify(rooms));
          editRoomModal.style.display = "none";
          overlay.style.display = "none";
          loadRooms();
        });

        // delete room
        window.deleteRoom = function (index) {
          let rooms = JSON.parse(localStorage.getItem("rooms")) || [];
          if (rooms[index].occupied > 0) {
            alert("Can't delete. The room is occupied!");
            return;
          }
          rooms.splice(index, 1);
          localStorage.setItem("rooms", JSON.stringify(rooms));
          loadRooms();
        };

        // modal open/close handling
        addRoomBtn.addEventListener("click", () => {
          addRoomModal.style.display = "block";
          overlay.style.display = "block";
        });

        document.querySelectorAll(".closeModal").forEach(btn => {
          btn.addEventListener("click", () => {
            [addRoomModal, editRoomModal, detailsModal].forEach(m => (m.style.display = "none"));
            overlay.style.display = "none";
          });
        });
      });
    </script>
  </body>
</html>
